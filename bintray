#!/bin/bash

ARTIFACT=target/scala-*/craft-server-assembly-*.jar
API_URL=https://api.bintray.com
API_AUTH=-unsg:$bintray_api_key

# Upload master to bintray
if [ "x$TRAVIS_BRANCH" == "xmaster" ] && [ ! $TRAVIS_PULL_REQUEST ]; then
	curl -X DELETE $API_AUTH $API_URL/packages/nsg/craft/craft-server/versions/dev
	curl -T $ARTIFACT $API_AUTH $API_URL/content/nsg/craft/craft-server/dev/craft-server-build-$TRAVIS_BUILD_NUMBER.jar
	curl -X POST -unsg:$bintray_api_key $API_URL/content/nsg/craft/craft-server/dev/publish
fi

# Upload tagged releases to bintray
if [ $TRAVIS_TAG ]; then
	curl -T $ARTIFACT $API_AUTH $API_URL/content/nsg/craft/craft-server/$TRAVIS_TAG/craft-server-build-$TRAVIS_BUILD_NUMBER.jar
	curl -X POST -unsg:$bintray_api_key $API_URL/content/nsg/craft/craft-server/$TRAVIS_TAG/publish
fi
